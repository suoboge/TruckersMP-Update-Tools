<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TMPæ›´æ–°å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .app-wrapper {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        /* çª—å£æ§åˆ¶æ  */
        .window-titlebar {
            -webkit-app-region: drag;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: rgba(0,0,0,0.15);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }
        
        .window-title {
            color: white;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .window-controls {
            -webkit-app-region: no-drag;
            display: flex;
            gap: 4px;
        }
        
        .control-btn {
            width: 32px;
            height: 28px;
            border: none;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 14px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .control-btn:hover {
            background: rgba(255,255,255,0.25);
        }
        
        .control-btn.close:hover {
            background: #e81123;
        }
        
        /* ä¸»å†…å®¹åŒº */
        .main-content {
            flex: 1;
            max-width: 1100px;
            margin: 0 auto;
            padding: 25px;
            width: 100%;
            margin-top: 45px; /* æ·»åŠ ä¸Šè¾¹è·ä»¥é¿å…æ ‡é¢˜æ é®æŒ¡ */
        }
        
        /* å¤´éƒ¨ */
        .app-header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .app-header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .app-header p {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        /* å¡ç‰‡æ ·å¼ */
        .card {
            background: rgba(255,255,255,0.95);
            border-radius: 16px;
            padding: 28px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.12);
        }
        
        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #1a1a2e;
        }
        
        /* ç›®å½•è¾“å…¥åŒºåŸŸ */
        .directory-section {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .directory-item {
            background: #f8f9fa;
            padding: 18px;
            border-radius: 12px;
            border: 1px solid #e9ecef;
        }
        
        .directory-label {
            font-size: 0.85rem;
            color: #6c757d;
            margin-bottom: 10px;
            font-weight: 500;
        }
        
        .directory-input-group {
            display: flex;
            gap: 10px;
        }
        
        .directory-input-group input {
            flex: 1;
            padding: 10px 14px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 0.9rem;
        }
        
        .btn-select {
            padding: 10px 18px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
        }
        
        /* åŠŸèƒ½æŒ‰é’®åŒº */
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 20px;
        }
        
        .btn-action {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #fd7e14, #e83e8c);
            color: white;
        }
        
        .btn-action:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* è¿›åº¦åŒºåŸŸ */
        .progress-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .progress-bar-container {
            background: #e9ecef;
            height: 10px;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 5px;
            transition: width 0.3s ease;
        }
        
        /* æç¤ºæ¡† */
        .alert-box {
            padding: 14px 18px;
            border-radius: 10px;
            margin: 15px 0;
            font-size: 0.9rem;
        }
        
        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* åº•éƒ¨ç‰ˆæƒ */
        .app-footer {
            text-align: center;
            padding: 18px;
            color: white;
            font-size: 0.85rem;
            background: rgba(0,0,0,0.1);
            line-height: 1.8;
        }
        
        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .main-content {
                padding: 15px;
            }
            
            .app-header h1 {
                font-size: 1.6rem;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn-action {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="app-wrapper">
        <!-- çª—å£æ ‡é¢˜æ  -->
        <div class="window-titlebar">
            <div class="window-title">
                <span>ğŸš›</span>
                <span>TMPæ›´æ–°å·¥å…·</span>
            </div>
            <div class="window-controls">
                <button class="control-btn" onclick="minimizeWindow()">â”€</button>
                <button class="control-btn close" onclick="closeWindow()">âœ•</button>
            </div>
        </div>
        
        <div class="main-content">
            <!-- å¤´éƒ¨ -->
            <div class="app-header">
                <h1>ğŸš› TMPæ›´æ–°å·¥å…·</h1>
                <p>æ™ºèƒ½æ£€æµ‹å’Œæ›´æ–°TruckersMPæ’ä»¶æ–‡ä»¶</p>
            </div>

            <!-- ç›®å½•è®¾ç½®å¡ç‰‡ -->
            <div class="card">
                <div class="card-title">ğŸ“ ç›®å½•è®¾ç½®</div>
                
                <div class="alert-box alert-info">
                    <strong>ğŸ’¡ ä½¿ç”¨è¯´æ˜ï¼š</strong><br/>
                    â€¢ å…ˆè·å–æ–‡ä»¶åˆ—è¡¨ï¼Œç„¶åæ£€æŸ¥æƒé™<br/>
                    â€¢ æ—§ç‰ˆç›®å½•éœ€è¦ç®¡ç†å‘˜æƒé™<br/>
                    â€¢ åˆ†åˆ«æ›´æ–°æ–°ç‰ˆå’Œæ—§ç‰ˆæ–‡ä»¶<br/>
                    â€¢ ç‰¹åˆ«è¯´æ˜æœ¬å·¥å…·å®Œå…¨å…è´¹ï¼Œå¦‚é‡åˆ°æ”¶è´¹æƒ…å†µè¯·è”ç³»ä½œè€…åé¦ˆã€‚
                </div>
                
                <div class="directory-section">
                    <div class="directory-item">
                        <div class="directory-label">æ–°ç‰ˆç›®å½•ï¼ˆç”¨æˆ·ç›®å½•ï¼‰</div>
                        <div class="directory-input-group">
                            <input 
                                type="text" 
                                id="newDirInput"
                                value="C:\Users\Administrator\AppData\Roaming\TruckersMP\installation"
                                placeholder="è¯·è¾“å…¥æ–°ç‰ˆç›®å½•è·¯å¾„"
                            />
                            <button class="btn-select" onclick="selectDirectory('new')">
                                é€‰æ‹©
                            </button>
                        </div>
                    </div>
                    
                    <div class="directory-item">
                        <div class="directory-label">æ—§ç‰ˆç›®å½•ï¼ˆç³»ç»Ÿç›®å½• - éœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰</div>
                        <div class="directory-input-group">
                            <input 
                                type="text" 
                                id="oldDirInput"
                                value="C:\ProgramData\TruckersMP"
                                placeholder="è¯·è¾“å…¥æ—§ç‰ˆç›®å½•è·¯å¾„"
                            />
                            <button class="btn-select" onclick="selectDirectory('old')">
                                é€‰æ‹©
                            </button>
                        </div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn-action btn-primary" onclick="getFiles()" id="btnGetFiles">
                        <span style="font-size:1.1em">ğŸ“‹</span> è·å–æ–‡ä»¶åˆ—è¡¨
                    </button>
                    
                    <button class="btn-action btn-secondary" onclick="checkPermissions()" id="btnCheckPerm">
                        ğŸ”’ æ£€æŸ¥æƒé™
                    </button>
                    
                    <button class="btn-action btn-success" onclick="updateFiles('new')" id="btnUpdateNew">
                        ğŸ†• æ›´æ–°æ–°ç‰ˆ
                    </button>
                    
                    <button class="btn-action btn-warning" onclick="updateFiles('old')" id="btnUpdateOld">
                        ğŸ”„ æ›´æ–°æ—§ç‰ˆ
                    </button>
                </div>
            </div>

            <!-- çŠ¶æ€æç¤º -->
            <div id="statusMessage" class="alert-box" style="display: none;"></div>

            <!-- è¿›åº¦æ¡ -->
            <div id="progressSection" class="card progress-section" style="display: none;">
                <div class="progress-header">
                    <span>ğŸ“Š æ›´æ–°è¿›åº¦</span>
                    <span id="progressPercent">0%</span>
                </div>
                <div id="currentFile" style="margin-bottom: 10px; color: #6c757d; font-size: 0.9rem;"></div>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="progressBar" style="width: 0%"></div>
                </div>
            </div>
            
            <!-- æ–‡ä»¶åˆ—è¡¨ -->
            <div id="fileListSection" class="card" style="display: none;">
                <div class="card-title">
                    ğŸ“ æ–‡ä»¶åˆ—è¡¨ 
                    <span style="background: #667eea; color: white; padding: 4px 12px; border-radius: 12px; font-size: 0.8rem;" id="fileCount">0 ä¸ªæ–‡ä»¶</span>
                </div>
                
                <div id="fileListContainer" style="max-height: 300px; overflow-y: auto;">
                    <!-- æ–‡ä»¶åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
        
        <!-- åº•éƒ¨ç‰ˆæƒ -->
        <div class="app-footer">
            <div>2022-2026 Â© é¹¿é€”è½¦é˜Ÿ</div>
            <div>ä½œè€…: é¹¿é€”é²ç­ä¸¨QQ2822296635</div>
            <div>ç‰¹åˆ«é¸£è°¢: é•¿ç‚­æä¾›APIæœåŠ¡</div>
        </div>
    </div>

    <script>
        let fileList = [];
        let updating = false;

        // çª—å£æ§åˆ¶å‡½æ•°
        function minimizeWindow() {
            if (window.electron && window.electron.ipcRenderer) {
                window.electron.ipcRenderer.send('minimize-window');
            }
        }

        function closeWindow() {
            if (window.electron && window.electron.ipcRenderer) {
                window.electron.ipcRenderer.send('close-window');
            }
        }

        // è®¾ç½®çŠ¶æ€æ¶ˆæ¯
        function setStatusMessage(message, type = 'info') {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.innerHTML = message.replace(/\n/g, '<br>');
            statusDiv.className = `alert-box alert-${type}`;
            statusDiv.style.display = 'block';
        }

        // æ˜¾ç¤º/éšè—è¿›åº¦æ¡
        function showProgress(show) {
            document.getElementById('progressSection').style.display = show ? 'block' : 'none';
        }

        // æ›´æ–°è¿›åº¦
        function updateProgress(percent, currentFile = '') {
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('progressPercent').textContent = percent + '%';
            document.getElementById('currentFile').textContent = currentFile ? 'å½“å‰æ–‡ä»¶: ' + currentFile : '';
        }

        // é€‰æ‹©ç›®å½•
        async function selectDirectory(type) {
            try {
                const selectedPath = await window.electronAPI.selectDirectory();
                if (selectedPath) {
                    const inputId = type === 'new' ? 'newDirInput' : 'oldDirInput';
                    document.getElementById(inputId).value = selectedPath;
                    
                    // ä¿å­˜é€‰æ‹©çš„ç›®å½•åˆ°æœ¬åœ°å­˜å‚¨
                    localStorage.setItem(`lastSelectedDir_${type}`, selectedPath);
                    
                    setStatusMessage(`å·²é€‰æ‹©ç›®å½•: ${selectedPath}`, 'success');
                }
            } catch (error) {
                setStatusMessage('é€‰æ‹©ç›®å½•å¤±è´¥: ' + error.message, 'error');
            }
        }

        // è·å–æ–‡ä»¶åˆ—è¡¨
        async function getFiles() {
            if (updating) return;
            updating = true;
            setButtonState(true);
            
            try {
                setStatusMessage('æ­£åœ¨è·å–æ–‡ä»¶åˆ—è¡¨...', 'info');
                fileList = await window.electronAPI.getFileList();
                displayFileList();
                setStatusMessage(`æˆåŠŸè·å– ${fileList.length} ä¸ªæ–‡ä»¶`, 'success');
            } catch (error) {
                setStatusMessage(error.message, 'error');
            } finally {
                updating = false;
                setButtonState(false);
            }
        }

        // æ£€æŸ¥æƒé™
        async function checkPermissions() {
            if (updating) return;
            updating = true;
            setButtonState(true);
            
            try {
                setStatusMessage('æ£€æŸ¥æ–°ç‰ˆç›®å½•æƒé™...', 'info');
                const newDir = document.getElementById('newDirInput').value;
                const newPerm = await window.electronAPI.checkPermission(newDir);
                
                setStatusMessage('æ£€æŸ¥æ—§ç‰ˆç›®å½•æƒé™...', 'info');
                const oldDir = document.getElementById('oldDirInput').value;
                const oldPerm = await window.electronAPI.checkPermission(oldDir);
                
                let message = 'æƒé™æ£€æŸ¥å®Œæˆï¼<br>';
                message += `æ–°ç‰ˆç›®å½•: ${newPerm.hasPermission ? 'âœ… æœ‰æƒé™' : 'âŒ æ— æƒé™'}<br>`;
                message += `æ—§ç‰ˆç›®å½•: ${oldPerm.hasPermission ? 'âœ… æœ‰æƒé™' : 'âŒ æ— æƒé™'}`;
                
                if (!oldPerm.hasPermission) {
                    message += '<br><br>æ—§ç‰ˆç›®å½•éœ€è¦ç®¡ç†å‘˜æƒé™ï¼';
                }
                
                setStatusMessage(message, oldPerm.hasPermission ? 'success' : 'warning');
            } catch (error) {
                setStatusMessage('æƒé™æ£€æŸ¥å¤±è´¥: ' + error.message, 'error');
            } finally {
                updating = false;
                setButtonState(false);
            }
        }
        // æ›´æ–°æ–‡ä»¶ï¼ˆå¸¦MD5æ ¡éªŒï¼‰
        async function updateFiles(versionType) {
            if (updating || fileList.length === 0) return;
            
            const targetDir = versionType === 'new' ? 
                document.getElementById('newDirInput').value : 
                document.getElementById('oldDirInput').value;
            
            const versionName = versionType === 'new' ? 'æ–°ç‰ˆ' : 'æ—§ç‰ˆ';
            
            updating = true;
            setButtonState(true);
            showProgress(true);
            updateProgress(0);
            
            try {
                // è¿‡æ»¤éœ€è¦æ›´æ–°çš„æ–‡ä»¶
                const filesToUpdate = fileList.filter(file => 
                    versionType === 'new' ? !file.filePath.includes('core') : file.filePath.includes('core')
                );
                
                if (filesToUpdate.length === 0) {
                    setStatusMessage(`${versionName}ç›®å½•æ²¡æœ‰éœ€è¦æ›´æ–°çš„æ–‡ä»¶`, 'info');
                    return;
                }
                
                setStatusMessage(`å¼€å§‹æ£€æŸ¥${versionName}æ–‡ä»¶ï¼Œå…± ${filesToUpdate.length} ä¸ªæ–‡ä»¶...`, 'info');
                
                let successCount = 0;
                let errorCount = 0;
                let skipCount = 0;
                
                for (let i = 0; i < filesToUpdate.length; i++) {
                    const file = filesToUpdate[i];
                    const progress = Math.round(((i + 1) / filesToUpdate.length) * 100);
                    
                    updateProgress(progress, file.filePath);
                    
                    try {
                        const result = await window.electronAPI.downloadFile(
                            file.downloadUrl, 
                            file.filePath, 
                            targetDir,
                            file.md5 // ä¼ é€’MD5è¿›è¡Œæ ¡éªŒ
                        );
                        
                        if (result && result.skipped) {
                            skipCount++;
                            console.log(`è·³è¿‡æ–‡ä»¶: ${file.filePath} - ${result.reason}`);
                        } else {
                            successCount++;
                        }
                    } catch (error) {
                        errorCount++;
                        console.error(`æ›´æ–°å¤±è´¥: ${file.filePath}`, error);
                    }
                }
                
                let message = `${versionName}æ›´æ–°å®Œæˆï¼`;
                message += `æˆåŠŸ: ${successCount}, `;
                message += `è·³è¿‡: ${skipCount}, `;
                message += `å¤±è´¥: ${errorCount}`;
                
                if (skipCount > 0) {
                    message += `<br>è·³è¿‡çš„æ–‡ä»¶å·²æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼ˆMD5åŒ¹é…ï¼‰`;
                }
                
                setStatusMessage(message, errorCount === 0 ? 'success' : 'warning');
                
            } catch (error) {
                setStatusMessage('æ›´æ–°å¤±è´¥: ' + error.message, 'error');
            } finally {
                updating = false;
                setButtonState(false);
                showProgress(false);
            }
        }

        // æ˜¾ç¤ºæ–‡ä»¶åˆ—è¡¨ï¼ˆåŒ…å«MD5ä¿¡æ¯ï¼‰
        function displayFileList() {
            const container = document.getElementById('fileListContainer');
            const countElement = document.getElementById('fileCount');
            const section = document.getElementById('fileListSection');
            
            container.innerHTML = '';
            countElement.textContent = fileList.length + ' ä¸ªæ–‡ä»¶';
            
            fileList.slice(0, 30).forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid #f1f3f5;';
                
                const fileInfo = document.createElement('div');
                fileInfo.style.cssText = 'flex: 1; min-width: 0;';
                
                const fileName = document.createElement('div');
                fileName.textContent = file.filePath;
                fileName.style.cssText = 'font-size: 0.9rem; color: #495057; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;';
                
                const fileMD5 = document.createElement('div');
                fileMD5.textContent = file.md5 ? `MD5: ${file.md5.substring(0, 8)}...` : 'MD5: æœªçŸ¥';
                fileMD5.style.cssText = 'font-size: 0.7rem; color: #6c757d; margin-top: 2px;';
                
                fileInfo.appendChild(fileName);
                fileInfo.appendChild(fileMD5);
                
                const fileType = document.createElement('span');
                fileType.textContent = file.filePath.includes('core') ? 'æ—§ç‰ˆ' : 'æ–°ç‰ˆ';
                fileType.style.cssText = file.filePath.includes('core') ? 
                    'background: #fd7e14; color: white; padding: 2px 8px; border-radius: 8px; font-size: 0.7rem;' : 
                    'background: #28a745; color: white; padding: 2px 8px; border-radius: 8px; font-size: 0.7rem;';
                
                fileItem.appendChild(fileInfo);
                fileItem.appendChild(fileType);
                container.appendChild(fileItem);
            });
            
            if (fileList.length > 30) {
                const moreText = document.createElement('div');
                moreText.textContent = `è¿˜æœ‰ ${fileList.length - 30} ä¸ªæ–‡ä»¶...`;
                moreText.style.cssText = 'padding: 12px; text-align: center; color: #6c757d;';
                container.appendChild(moreText);
            }
            
            section.style.display = 'block';
        }

        // è®¾ç½®æŒ‰é’®çŠ¶æ€
        function setButtonState(disabled) {
            const buttons = ['btnGetFiles', 'btnCheckPerm', 'btnUpdateNew', 'btnUpdateOld'];
            buttons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) btn.disabled = disabled;
            });
        }

        // åˆå§‹åŒ–è¿›åº¦ç›‘å¬
        if (window.electronAPI) {
            window.electronAPI.onDownloadProgress((data) => {
                updateProgress(data.progress, data.filePath);
            });
        }

        // åŠ è½½TruckersMPé…ç½®
        async function loadTruckersmpConfig() {
            try {
                const config = await window.electronAPI.readTruckersmpConfig();
                if (config && config.installPath) {
                    const newDirInput = document.getElementById('newDirInput');
                    
                    // å¤„ç†æ–°ç‰ˆæ’ä»¶ç›®å½•è·¯å¾„
                    let installPath = config.installPath;
                    
                    // å¦‚æœè·¯å¾„ä»¥installationç»“å°¾ï¼Œç›´æ¥ä½¿ç”¨
                    if (installPath.endsWith('installation')) {
                        newDirInput.value = installPath;
                    } 
                    // å¦åˆ™æ£€æŸ¥è·¯å¾„æ˜¯å¦æŒ‡å‘TruckersMPç›®å½•ï¼Œéœ€è¦æ·»åŠ installationå­ç›®å½•
                    else if (installPath.includes('TruckersMP')) {
                        // ç¡®ä¿è·¯å¾„è§„èŒƒåŒ–ï¼Œå»é™¤æœ«å°¾çš„æ–œæ 
                        installPath = installPath.replace(/[\\/]+$/, '');
                        
                        // å¦‚æœå·²ç»æ˜¯TruckersMPæ ¹ç›®å½•ï¼Œæ·»åŠ installation
                        if (installPath.endsWith('TruckersMP')) {
                            newDirInput.value = `${installPath}\\installation`;
                        } 
                        // å¦‚æœå·²ç»æ˜¯installationçš„çˆ¶ç›®å½•ï¼Œç›´æ¥ä½¿ç”¨
                        else if (fs.existsSync(path.join(installPath, 'installation'))) {
                            newDirInput.value = `${installPath}\\installation`;
                        }
                        // å…¶ä»–æƒ…å†µç›´æ¥ä½¿ç”¨åŸè·¯å¾„
                        else {
                            newDirInput.value = installPath;
                        }
                    }
                    // å…¶ä»–æƒ…å†µç›´æ¥ä½¿ç”¨åŸè·¯å¾„
                    else {
                        newDirInput.value = installPath;
                    }
                    
                    setStatusMessage('å·²è‡ªåŠ¨åŠ è½½TruckersMPå®‰è£…è·¯å¾„', 'success');
                }
            } catch (error) {
                console.log('è¯»å–TruckersMPé…ç½®å¤±è´¥:', error.message);
                // é™é»˜å¤±è´¥ï¼Œä¸å½±å“æ‰‹åŠ¨é€‰æ‹©åŠŸèƒ½
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', () => {
            // é¦–å…ˆå°è¯•ä»æœ¬åœ°å­˜å‚¨åŠ è½½ä¸Šæ¬¡é€‰æ‹©çš„ç›®å½•
            const lastNewDir = localStorage.getItem('lastSelectedDir_new');
            const lastOldDir = localStorage.getItem('lastSelectedDir_old');
            
            if (lastNewDir) {
                document.getElementById('newDirInput').value = lastNewDir;
            }
            if (lastOldDir) {
                document.getElementById('oldDirInput').value = lastOldDir;
            }
            
            // ç„¶åå°è¯•åŠ è½½TruckersMPé…ç½®
            loadTruckersmpConfig();
        });
    </script>
</body>
</html>