# 🚛 TMP更新工具 v2.0

智能检测和更新TruckersMP插件文件，支持新版和旧版目录结构。

## ✨ 新增功能 - MD5校验

### 🎯 MD5校验功能
- **智能文件比较**: 通过MD5哈希值比较本地文件和服务器文件
- **跳过重复下载**: 如果本地文件MD5与服务器文件匹配，自动跳过下载
- **完整性验证**: 下载完成后再次验证MD5，确保文件完整性
- **详细状态反馈**: 显示跳过、成功、失败的文件数量

### 📊 更新流程
1. 获取服务器文件列表（包含MD5信息）
2. 检查每个文件的本地MD5与服务器MD5
3. **匹配**: 跳过下载，记录为"跳过"
4. **不匹配**: 下载文件并验证完整性
5. 显示最终更新结果

## 🚀 使用方法

### 1. 启动应用
```bash
npm start
```

### 2. 目录设置
- **新版目录**: 用户目录 (`C:\Users\用户名\AppData\Roaming\TruckersMP\installation`)
- **旧版目录**: 系统目录 (`C:\ProgramData\TruckersMP`)

### 3. 操作步骤
1. **获取文件列表**: 从服务器获取最新文件信息和MD5
2. **检查权限**: 验证对目标目录的写入权限
3. **更新新版**: 更新用户目录文件（自动跳过MD5匹配的文件）
4. **更新旧版**: 更新系统目录文件（需要管理员权限）

## 🔧 技术特性

### MD5校验实现
```javascript
// 计算文件MD5
function calculateFileMD5(filePath) {
    // 使用crypto模块计算MD5哈希值
}

// 检查是否需要更新
async function checkFileNeedUpdate(filePath, expectedMD5) {
    // 比较本地文件MD5与期望MD5
    // 返回是否需要更新
}
```

### 文件更新逻辑
- ✅ 文件不存在 → 需要下载
- ✅ MD5不匹配 → 需要下载  
- ✅ MD5匹配 → 跳过下载
- ✅ 下载后MD5验证 → 确保文件完整性

## 📋 更新结果说明

### 成功更新
```
更新完成！成功: 15, 跳过: 8, 失败: 0
跳过的文件已是最新版本（MD5匹配）
```

### 字段说明
- **成功**: 成功下载并验证的文件数量
- **跳过**: MD5匹配，已是最新版本的文件数量  
- **失败**: 下载或验证失败的文件数量

## 🛠 开发信息

### 技术栈
- **前端**: HTML5, CSS3, JavaScript (ES6+)
- **后端**: Electron, Node.js
- **网络请求**: Axios
- **加密**: Crypto模块 (MD5计算)

### 项目结构
```
tmp-update-tool-v2/
├── main.js          # 主进程，包含MD5校验逻辑
├── preload.js       # 预加载脚本，API桥接
├── index.html       # 用户界面
├── package.json     # 项目配置和依赖
└── assets/          # 资源文件
```

## ⚠️ 注意事项

1. **管理员权限**: 旧版目录更新需要管理员权限
2. **网络连接**: 需要互联网连接获取文件列表
3. **MD5字段**: 服务器API必须提供文件的MD5信息
4. **文件完整性**: MD5校验确保下载的文件完整无误

## 📞 支持信息

- **作者**: 鹿途鲁班
- **QQ**: 2822296635
- **特别鸣谢**: 长炭提供API服务

## 🔄 版本历史

### v2.0 (当前)
- ✅ 新增MD5校验功能
- ✅ 智能跳过已最新文件
- ✅ 下载完整性验证
- ✅ 改进的用户界面显示

### v1.0
- 基础文件下载功能
- 目录选择和管理
- 基本的更新流程

---

**🚛 享受更智能、更高效的TMP更新体验！**
